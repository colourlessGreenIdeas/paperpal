<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaperPal Comparison Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <!-- Add KaTeX JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <!-- Add auto-render extension for KaTeX -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    <!-- Add marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .content-panel {
            height: calc(100vh - 6rem);
        }
        /* Add some styling for equation blocks */
        .katex-display {
            margin: 1em 0;
            padding: 1em;
            background: #f8fafc;
            border-radius: 0.5rem;
            overflow-x: auto;
        }
        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: left;
        }
        th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        /* List styles */
        ul, ol {
            padding-left: 1.5em;
            margin: 1em 0;
        }
        ul {
            list-style-type: disc;
        }
        ol {
            list-style-type: decimal;
        }
        /* Code block styles */
        pre {
            background-color: #f8fafc;
            padding: 1em;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1em 0;
        }
        code {
            font-family: ui-monospace, monospace;
            font-size: 0.9em;
            padding: 0.2em 0.4em;
            background-color: #f1f5f9;
            border-radius: 0.25rem;
        }
        pre code {
            padding: 0;
            background-color: transparent;
        }
        /* Blockquote styles */
        blockquote {
            border-left: 4px solid #e2e8f0;
            padding-left: 1em;
            margin: 1em 0;
            color: #64748b;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">PaperPal Comparison Viewer</h1>
            <div class="flex gap-4">
                <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Original Version</label>
                    <input type="file" id="file1" accept=".json" 
                           class="block w-full text-sm text-gray-500
                                  file:mr-4 file:py-2 file:px-4
                                  file:rounded-md file:border-0
                                  file:text-sm file:font-semibold
                                  file:bg-blue-50 file:text-blue-700
                                  hover:file:bg-blue-100">
                </div>
                <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Simplified Version</label>
                    <input type="file" id="file2" accept=".json" 
                           class="block w-full text-sm text-gray-500
                                  file:mr-4 file:py-2 file:px-4
                                  file:rounded-md file:border-0
                                  file:text-sm file:font-semibold
                                  file:bg-blue-50 file:text-blue-700
                                  hover:file:bg-blue-100">
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="flex gap-4">
            <!-- Left Panel -->
            <div class="flex-1 bg-white rounded-lg shadow-lg p-6">
                <div class="mb-2">
                    <h2 id="leftTitle" class="text-xl font-semibold text-gray-800">Original Version</h2>
                    <p id="leftMetadata" class="text-sm text-gray-500"></p>
                </div>
                <div id="leftPanel" class="content-panel overflow-y-auto prose prose-sm max-w-none">
                    <p class="text-gray-500 italic">Please load a file...</p>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="flex-1 bg-white rounded-lg shadow-lg p-6">
                <div class="mb-2">
                    <h2 id="rightTitle" class="text-xl font-semibold text-gray-800">Simplified Version</h2>
                    <p id="rightMetadata" class="text-sm text-gray-500"></p>
                </div>
                <div id="rightPanel" class="content-panel overflow-y-auto prose prose-sm max-w-none">
                    <p class="text-gray-500 italic">Please load a file...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configure marked options
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: false,
            mangle: false
        });

        // Synchronize scrolling between panels
        const leftPanel = document.getElementById('leftPanel');
        const rightPanel = document.getElementById('rightPanel');
        
        leftPanel.addEventListener('scroll', () => {
            rightPanel.scrollTop = leftPanel.scrollTop;
        });
        
        rightPanel.addEventListener('scroll', () => {
            leftPanel.scrollTop = rightPanel.scrollTop;
        });

        // Function to render math in an element
        function renderMath(element) {
            renderMathInElement(element, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false}
                ],
                throwOnError: false,
                output: 'html'
            });
        }

        // Function to process content (markdown + math)
        function processContent(content) {
            // First convert markdown to HTML
            const htmlContent = marked.parse(content);
            return htmlContent;
        }

        // Handle file loading
        function handleFileLoad(file, panelId, titleId, metadataId) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    const panel = document.getElementById(panelId);
                    const titleElem = document.getElementById(titleId);
                    const metadataElem = document.getElementById(metadataId);
                    
                    // Update metadata
                    titleElem.textContent = `${data.metadata.grade_level} Version`;
                    metadataElem.textContent = `Generated: ${data.metadata.generated_at} â€¢ Total Chunks: ${data.metadata.total_chunks}`;
                    
                    // Clear existing content
                    panel.innerHTML = '';
                    
                    // Add chunks
                    data.chunks.forEach((chunk, index) => {
                        const div = document.createElement('div');
                        div.className = 'mb-6 p-4 bg-gray-50 rounded-lg';
                        
                        // Process the content
                        const processedContent = processContent(chunk);
                        
                        div.innerHTML = `
                            <div class="text-xs font-medium text-gray-500 mb-2">Chunk ${index + 1}</div>
                            <div class="text-gray-800 prose prose-sm max-w-none">${processedContent}</div>
                        `;
                        panel.appendChild(div);
                        
                        // Render math in this chunk
                        renderMath(div);
                    });
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                    panel.innerHTML = '<p class="text-red-500">Error loading file. Please ensure it\'s a valid JSON file.</p>';
                }
            };
            reader.readAsText(file);
        }

        // Set up file input handlers
        document.getElementById('file1').addEventListener('change', (e) => {
            if (e.target.files[0]) {
                handleFileLoad(e.target.files[0], 'leftPanel', 'leftTitle', 'leftMetadata');
            }
        });

        document.getElementById('file2').addEventListener('change', (e) => {
            if (e.target.files[0]) {
                handleFileLoad(e.target.files[0], 'rightPanel', 'rightTitle', 'rightMetadata');
            }
        });
    </script>
</body>
</html> 